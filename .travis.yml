language: java
sudo: false

jdk:
  - oraclejdk8

cache:
  directories:
    - ${HOME}/.m2

branches:
  only:
    - "master"

env:
  matrix:
    - MODULE='apache-tinkerpop' ARGS='-DskipTests=true'
    - MODULE='janusgraph-berkeleyje'
    - MODULE='janusgraph-cassandra'
    - MODULE='janusgraph-es' ARGS='-DthreadCount=1'
    - MODULE='janusgraph-hadoop-parent/janusgraph-hadoop-2'
    - MODULE='janusgraph-hbase-parent/janusgraph-hbase-098'
    - MODULE='janusgraph-hbase-parent/janusgraph-hbase-10'
    - MODULE='janusgraph-lucene' ARGS='-DthreadCount=1'
    - MODULE='janusgraph-solr' ARGS='-DthreadCount=1'
    - MODULE='janusgraph-test'

matrix:
  # https://docs.travis-ci.com/user/customizing-the-build#Rows-that-are-Allowed-to-Fail
  allow_failures:
    # Non-deterministic: can pass or fail, regardless of any relevant changes.
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/198165185
    - env: MODULE='janusgraph-berkeleyje'

    # Currently broken due to too many log statements (exceeds 4MB)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197472452
    - env: MODULE='janusgraph-cassandra'

    # Currently broken due to too many log statements (exceeds 4MB)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197472453
    - env: MODULE='janusgraph-es' ARGS='-DthreadCount=1'

    # Currently broken due to too many log statements (exceeds 4MB)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197672947
    - env: MODULE='janusgraph-hadoop-parent/janusgraph-hadoop-2'

    # Currently broken due to timeout (runs longer than 50min)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197672951
    - env: MODULE='janusgraph-hbase-parent/janusgraph-hbase-098'

    # Currently broken due to timeout (runs longer than 50min)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197672952
    - env: MODULE='janusgraph-hbase-parent/janusgraph-hbase-10'

    # Currently broken due to too many log statements (exceeds 4MB)
    # https://travis-ci.org/JanusGraph/janusgraph/jobs/197427609
    - env: MODULE='janusgraph-solr' ARGS='-DthreadCount=1'

addons:
  apt:
    packages:
      - oracle-java8-installer

script:
  - mvn install -DskipTests=true -B -pl ${MODULE} -am
  - mvn verify -pl ${MODULE} ${ARGS}

# Syntax and more info: https://docs.travis-ci.com/user/notifications
notifications:
  email:
    - cjquinon@us.ibm.com
